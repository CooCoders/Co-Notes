# Linux

## 网络连接的三种模式

网络连接的三种模式（虚拟机安装网络设置的三个选项）

桥接模式：虚拟系统可以与外界通讯，但是易造成 IP 冲突（虚拟系统与主机网络在同一个网段）

NAT模式：网络地址转换模式，将主机和虚拟系统构建一个网络系统（与主机网络不同），这两个之间可进行通信，虚拟系统可通过主机 IP 访问外网，因此不易造成 IP 冲突

主机模式：主机和虚拟系统构建一个独立系统



## 目录结构

Linux 下一切皆文件

根目录为 `/`，具体的目录结构：

- `/bin`（`/usr/bin`，`/usr/local/bin`）存放最常使用的命令
- `/sbin`（`/usr/sbin`, `/usr/local/sbin`）存放系统管理员管理程序
- `/home`存放普通用户的主目录，系统中每个用户都有一个自己的目录，该目录以用户名命名
- `/root`系统管理员主目录
- `/lib`系统开机所需要的冬天连接共享库
- `/lost+found`一般为空，系统非法关机后存放文件
- `/etc`系统管理所需要的配置文件和子目录
- `/usr`用户安装的程序和文件默认放在这个目录下
- `/boot`启动 linux 使用的核心文件
- `/proc`虚拟目录，获取系统信息
- `/srv`服务启动后提取的数据
- `/tmp`存放临时文件
- `/dev` 类似 windows 下的设备管理器，将所有的硬件按照文件形式存储
- `/media` linux 会自动识别一些设备，并且将他们挂载到这个目录下
- `/mnt` 让用户临时挂载别的文件系统，可以将外部的存储挂载到该目录下，然后进入即可看到内容
- `/opt` 给主机额外安装软件**存放**的目录
- `/usr/local`额外软件安装的目录
- `/var` 存放不断扩充的东西，例如各种日志文件

连接远程服务器

使用命令 `ifconfig` 查看服务器 ip 地址，连接之间首先使用 `ping` 命令测试一下

## vi 和 vim 编辑器

### 三种工作状态

- 正常模式：使用 vi 或 vim 命令打开文件就直接进入一般模式，在此模式下，可以使用方向键移动光标以及进行删除、复制粘贴操作
- 编辑模式：按下 i、I、o、a等命令进入编辑模式
- 命令行模式：完成读取、存盘、替换、离开编辑器以及显示行号等操作

### 三种模式的切换

使用 vi 命令进入的即为 一般模式，在一般模式下通过 i 等命令进入 编辑模式，通过 ：或  / 进入命令模式，编辑模式和命令模式通过 esc 返回一般模式，此外，编辑模式通过 `:wq、:q、:q!`退出编辑器

### vi 快捷键

- 拷贝当前行，使用`yy`，如果需要拷贝当前行向下的多行，例如光标所在位置向下5行，使用`5yy`，粘贴为`p`（一般模式下）
- 删除当前行使用`dd`，多行同上（一般模式）
- 在文件中查找某个单词，使用`/KEYWORD`然后回车查找，输入`n`表示查找下一个（命令行模式）
- 设置显示文件的行号或取消行号显示，使用`:set nu`和`:set nonu`（命令行模式）
- 定位到文件的首行：`gg`，定位到文件的末行:`G`，例如修改文件`etc/profile`文件
- 撤销修改命令：在一般模式下输入`u`
- 快速移动到文件的某个位置，例如定位到第20行，在一般模式下，输入20 ，然后输入`shift+g`

## 开关机以及登录注销

关机或重启之前注意先使用命令`sync`将内存数据同步到磁盘，相关命令有：

- `shutdown -h now`立刻关机
- `shutdown -h 1`1分钟后关机
- `shutdown -r now`重新启动
- `halt`关机
- `reboot`重启

注意登录的时候少用 root 账号，避免操作失误，在普通账号下，使用`su root`切换为系统管理员，在 root 账号下，使用`logout`命令注销用户（root 注销后为普通用户，再次注销后退出系统）

此外 `logout` 命令在图形运行级别无效，在运行级别3下有效

## 用户管理

### 添加用户

在 root 账号下，使用命令`useradd USERNAME`添加用户，创建用户成功后，会自动创建和用户名同名的家目录，也可以通过 `useradd -d TARGET_DIR`为新创建的用户指定家目录

(root用户->普通用户：`su - USERNAME`，反之使用 `su - root`)

### 修改密码

为用户设置密码命令：`passwd USERNAME`，输入即可

### 删除用户

使用命令`userdel USERNAME`删除用户，此时保留家目录，如同时删除家目录，使用命令：`userdel -r USERNAME`

### 查询用户

使用命令`id USERNAME`查询用户信息，使用命令`whoami`查询当前用户的信息

### 切换用户

使用指令`su - USERNAME`切换用户，从权限高的用户切换到权限低的用户无需密码，反之需要，退回到原来用户的时候使用 `exit`或者`logout`

### 用户组

用户组类似于角色，系统为有共性的多个用户统一进行管理

新增组：`groupadd GROUPNAME`

删除组：`groupdel GROUPNAME`

变更组：`usermod -g GROUPNAME USERNAME`

用户组相关的目录：

- `/etc/passwd`文件：用户的配置文件，包括用户名、口令、用户标识号等
- `/etc/shadow`文件：口令的配置文件，包括登录名、加密口令等
- `/etc/group`文件：组的配置文件，包括组名、口令等信息

## 实用指令

### 运行级别

运行级别：

- 0：关机
- 1：单用户（找回丢失密码）
- 2：多用户状态没有网络服务
- 3：多用户状态有网络服务
- 4：系统未使用保留给用户
- 5：图形界面
- 6：系统重启

常用的运行级别是3和5，也可以指定默认的运行级别，通过 `init N`指令切换运行级别，使用`systemctl get-default`查看运行级别

### 帮助指令

例如，查看`ls`指令的帮助信息：

使用`man ls`或者`help ls`

### 文件目录类

- pwd 命令：输出当前工作目录的绝对路径
- ls命令：列出当前目录下的所有文件，常用的参数有`-a/-l`
- cd命令：切换到指定路径，`cd ~`回到当前用户的家目录，`cd ..`返回上层目录
- `mkdir DIRNAME`：创建一级目录，可以使用`mkdir -p DIRNAME1/DIRNAME2`创建多级目录（多层目录同时创建）
- `rmdir DIRNAME`：删除空目录，如文件夹非空，则使用`rm -rf DIRNAME`删除 （强制递归删除，危险操作）
- `touch FILENAME`：创建空文件



## Q&A

### 1. Linux 无法获得锁 /var/lib/dpkg/lock-frontend-open

出现这个问题是因为有其他的程序正在占用 apt-get 安装进程，可以手动杀死该进程：

```
sudo rm /var/lib/dpkg/lock-frontend
```

## ssh无法连接本地虚拟机

有可能是虚拟机 ssh 服务端，解决方案参考：

> https://www.dreams-true.com/lxqb/2250.html













